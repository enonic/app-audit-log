plugins {
    id 'com.enonic.defaults' version '2.0.1'
    id 'com.enonic.xp.app' version '2.0.0'
}

app {
    name = "${appName}"
    displayName = "${appDisplayName}"
    vendorName = "${vendorName}"
    vendorUrl = "${vendorUrl}"
    systemVersion = "${xpVersion}"
}

dependencies {
    compile "com.enonic.xp:core-api:${xpVersion}"
    compile "com.enonic.xp:portal-api:${xpVersion}"
    include "com.enonic.xp:lib-content:${xpVersion}"
    include "com.enonic.xp:lib-portal:${xpVersion}"
    include "com.enonic.xp:lib-auditlog:${xpVersion}"
    include "com.enonic.xp:lib-node:${xpVersion}"
    include "com.enonic.xp:lib-auth:${xpVersion}"
    include "com.enonic.xp:lib-admin:${xpVersion}"

    include "com.enonic.lib:lib-thymeleaf:2.0.0"
    include "com.enonic.lib:lib-admin-ui:3.0.2"

    //include "com.enonic.xp:lib-context:${xpVersion}"
    //include "com.enonic.xp:lib-i18n:${xpVersion}"
    //include "com.enonic.xp:lib-io:${xpVersion}"
    //include "com.enonic.xp:lib-mail:${xpVersion}"
    //include "com.enonic.xp:lib-repo:${xpVersion}"
    //include "com.enonic.xp:lib-websocket:${xpVersion}"
    //include "com.enonic.lib:lib-mustache:2.0.0"
    //include "com.enonic.lib:lib-util:2.0.0"
}

// Setup task in dev and not devmode? for getting not minified files.
task materialcssStyles(type: Copy) {
    from "node_modules/@materializecss/materialize/dist/css"
    include "*.min.css"
    into "$buildDir/resources/main/assets/styles"
}

task materialcssJs (type: Copy) {
    from "node_modules/@materializecss/materialize/dist/js"
    include "*.js"
    into "$buildDir/resources/main/assets/js"
}

task buildSass(type:Exec) {
    // See the sass.js for how the sass is compiled
    commandLine "node", "build_scripts/sass.js"
    inputs.files('src/main/resources/assets/styles')
    outputs.file('build/resources/main/assets/styles/styles.min.css')

    // Clean sometimes picks this up? Debug mostly
    doLast {
        assert file('build/resources/main/assets/styles/styles.min.css').exists()
    }
}

task buildJS(type:Exec) {
    commandLine "npm run build"
    inputs.files('src/main/resources/assets/js')
    outputs.file('build/resources/main/assets/js/tool.js')

    doLast {
        assert file('build/resources/main/assets/js/tool.js')
    }
}

jar {
    includeEmptyDirs = false
    dependsOn += buildSass
    dependsOn += materialcssStyles
    dependsOn += materialcssJs
} 

repositories {
    mavenLocal()
    jcenter()
    xp.enonicRepo()
}